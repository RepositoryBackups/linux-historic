<HTML
>
<!-- Mirrored from ftp.kh.edu.tw/Linux/Redhat/en_6.2/doc/ref-guide/s1-sysadmin-console-access.htm by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Sep 2016 21:05:10 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<HEAD
><TITLE
>Configuring Console Access</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.44"><LINK
REL="HOME"
TITLE="Red Hat Linux 6.2"
HREF="index-2.html"><LINK
REL="UP"
TITLE="System Administration"
HREF="ch-sysadmin.html"><LINK
REL="PREVIOUS"
TITLE="Users, Groups and User-Private Groups"
HREF="s1-sysadmin-usr-grps.html"><LINK
REL="NEXT"
TITLE="The floppy Group"
HREF="s1-sysadmin-floppy.html"></HEAD
><BODY
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Red Hat Linux 6.2: The Official Red Hat Linux Reference Guide</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="s1-sysadmin-usr-grps.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 2. System Administration</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="s1-sysadmin-floppy.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="S1-SYSADMIN-CONSOLE-ACCESS"
>Configuring Console Access</A
></H1
><P
>        When normal (non-root) users log in to a computer locally, they are
        given two types of special permission: they can run certain programs
        that they would not otherwise be able to run, and they can access
        certain files (normally special device files used to access diskettes,
        CD-ROMS, and so on) that they would not otherwise be able to access.
      </P
><P
>        Since there are multiple consoles on a single computer, and multiple
        users can be logged into the computer locally at the same time, one of
        the users has to "win" the fight to access the files. The first user to
        log in at the console owns those files.  Once the first user logs out,
        the next user who logs in will own the files.
      </P
><P
>        In contrast, <I
CLASS="EMPHASIS"
>every</I
> user who logs in at the console
        will be allowed to run programs normally restricted to the root user.
        By default, those programs will ask for the user's password.  This will
        be done graphically if X is running which makes it possible to include
        these actions as menu items in a graphical user interface.  As shipped,
        the console-accessible programs are <B
CLASS="COMMAND"
>shutdown</B
>,
        <B
CLASS="COMMAND"
>halt</B
>, and <B
CLASS="COMMAND"
>reboot</B
>.
      </P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="S2-SYSADMIN-PROGRAM"
>Disabling Console Program Access</A
></H2
><P
>          In environments where the console is otherwise secured (BIOS and LILO
          passwords are set,
          <B
CLASS="KEYCAP"
>Ctrl</B
>-<B
CLASS="KEYCAP"
>Alt</B
>-<B
CLASS="KEYCAP"
>Delete</B
>
          is disabled, the power and reset switches are disabled, etc.), it may
          not be desirable to allow arbitrary users at the console to run
          <B
CLASS="COMMAND"
>shutdown</B
>, <B
CLASS="COMMAND"
>halt</B
>, and
          <B
CLASS="COMMAND"
>reboot</B
>.
        </P
><P
>          In order to disable all access by console users to console programs,
          you should run the command:
        </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>rm -f</B
> <TT
CLASS="FILENAME"
>/etc/security/console.apps/*</TT
>
        </PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="S2-SYSADMIN-ALL"
>Disabling All Console Access</A
></H2
><P
>          In order to disable all console access, including program and file
          access, in the <TT
CLASS="FILENAME"
>/etc/pam.d/</TT
> directory, comment out
          all lines that refer to <TT
CLASS="FILENAME"
>pam_console.so</TT
>.  The
          following script will do the trick:
        </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>cd</B
> <TT
CLASS="FILENAME"
>/etc/pam.d</TT
>
<B
CLASS="COMMAND"
>for i in * ; do</B
>
<B
CLASS="COMMAND"
>sed '/[^#].*pam_console.so/s/^/#/' &#60; $i &#62; foo &#38;&#38; mv foo $i</B
>
<B
CLASS="COMMAND"
>done</B
>
        </PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="S2-SYSADMIN-DEFINE"
>Defining the Console</A
></H2
><P
>          The <TT
CLASS="FILENAME"
>/etc/security/console.perms</TT
> file defines the
          console group.  The syntax of that file is very flexible; you can edit
          the file so that these instructions no longer apply.  However, the
          default file has a line that looks like this:
        </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
> &#60;console&#62;=tty[0-9][0-9]* :[0-9]\.[0-9] :[0-9]</B
>
        </PRE
></TD
></TR
></TABLE
><P
>          When users log in, they are attached to some sort of named terminal,
          either an X server with a name like <B
CLASS="COMMAND"
>:0</B
> or
          <B
CLASS="COMMAND"
>mymachine.example.com:1.0</B
>; or a device like
          <TT
CLASS="FILENAME"
>/dev/ttyS0</TT
> or <TT
CLASS="FILENAME"
>/dev/pts/2</TT
>.
          The default is to define that local virtual consoles and local X
          servers are considered local, but if you want to consider the serial
          terminal next to you on port <TT
CLASS="FILENAME"
>/dev/ttyS1</TT
> to also
          be local, you can change that line to read:
        </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>&#60;console&#62;=tty[0-9][0-9]* :[0-9]\.[0-9] :[0-9] /dev/ttyS1</B
>
        </PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="S2-SYSADMIN-FILES"
>Making Files Console-Accessible</A
></H2
><P
>          In <TT
CLASS="FILENAME"
>/etc/security/console.perms</TT
>, there is a
          section with lines like:
        </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>&#60;floppy&#62;=/dev/fd[0-1]*</B
>
<B
CLASS="COMMAND"
>&#60;cdrom&#62;=/dev/cdrom</B
>
<B
CLASS="COMMAND"
>&#60;jaz&#62;=/dev/zip</B
>
        </PRE
></TD
></TR
></TABLE
><P
>          You can also add your own lines:
	</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>&#60;scanner&#62;=/dev/sga</B
>
	</PRE
></TD
></TR
></TABLE
><P
>          (Of course, make sure that <TT
CLASS="FILENAME"
>/dev/sga</TT
> is really
          your scanner and not, say, your hard drive.)
        </P
><P
>          That's the first part.  The second part is to define what is done with
          those files.  Look in the last section of
          <TT
CLASS="FILENAME"
>/etc/security/console.perms</TT
> for lines similar to:
	</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>&#60;console&#62; 0660 &#60;floppy&#62; 0660 root.floppy</B
>
<B
CLASS="COMMAND"
>&#60;console&#62; 0600 &#60;cdrom&#62;  0600 root.disk</B
>
<B
CLASS="COMMAND"
>&#60;console&#62; 0600 &#60;jaz&#62;    0660 root.disk</B
>
          </PRE
></TD
></TR
></TABLE
><P
>          and add a line like:
	</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>&#60;console&#62; 0600 &#60;scanner&#62; 0600 root</B
>
          </PRE
></TD
></TR
></TABLE
><P
>          Then, when you log in at the console, you will be given ownership of
          the <TT
CLASS="FILENAME"
>/dev/sga</TT
> device and the permissions will be
          0600 (readable and writable by you only).  When you log out, the
          device will be owned by root and still have 0600 (now: readable and
          writable by root only) permissions.
        </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="S2-SYSADMIN-ENABLE"
>Enabling Console Access for Other Applications</A
></H2
><P
>          If you wish to make other applications besides
          <B
CLASS="COMMAND"
>shutdown</B
>, <B
CLASS="COMMAND"
>reboot</B
>, and
          <B
CLASS="COMMAND"
>halt</B
> accessible to console users, you will have to
          do just a little bit more work.
        </P
><P
>          First of all, console access <I
CLASS="EMPHASIS"
>only</I
> works for
          applications which reside in <TT
CLASS="FILENAME"
>/sbin</TT
> or
          <TT
CLASS="FILENAME"
>/usr/sbin</TT
>, so the application that you wish to
          run must be there.
        </P
><P
>          Create a link from the name of your application to the
          <B
CLASS="COMMAND"
>/usr/bin/consolehelper</B
> application:
	</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>cd</B
> <TT
CLASS="FILENAME"
>/usr/bin</TT
>
<B
CLASS="COMMAND"
>ln -s</B
> <TT
CLASS="FILENAME"
>consolehelper</TT
> <TT
CLASS="FILENAME"
>foo</TT
>
	</PRE
></TD
></TR
></TABLE
><P
>          Create the file <TT
CLASS="FILENAME"
>/etc/security/console.apps/foo</TT
>:
	</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>touch</B
> <TT
CLASS="FILENAME"
>/etc/security/console.apps/foo</TT
>
	</PRE
></TD
></TR
></TABLE
><P
>          Create a PAM configuration file for the <TT
CLASS="REPLACEABLE"
><I
>foo</I
></TT
>
          service in <TT
CLASS="FILENAME"
>/etc/pam.d/</TT
>.  We suggest that you
          start with a copy of the shutdown service, then change it if you want
          to change the behavior:
	</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>cp</B
> <TT
CLASS="FILENAME"
>/etc/pam.d/shutdown</TT
> <TT
CLASS="FILENAME"
>/etc/pam.d/foo</TT
>
	</PRE
></TD
></TR
></TABLE
><P
>          Now, when you run <B
CLASS="COMMAND"
>/usr/bin/foo</B
>, it will call
          <B
CLASS="COMMAND"
>consolehelper</B
>, which, with the help of
          <B
CLASS="COMMAND"
>/usr/sbin/userhelper</B
> will authenticate the user
          (asking for the user's password if <TT
CLASS="FILENAME"
>/etc/pam.d/foo</TT
>
          is a copy of <TT
CLASS="FILENAME"
>/etc/pam.d/shutdown</TT
>; otherwise, it
          will do precisely what is specified in
          <TT
CLASS="FILENAME"
>/etc/pam.d/foo</TT
>) and then run
          <TT
CLASS="FILENAME"
>/usr/sbin/foo</TT
> with root permissions.
        </P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="s1-sysadmin-usr-grps.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index-2.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="s1-sysadmin-floppy.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Users, Groups and User-Private Groups</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="ch-sysadmin.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>The <TT
CLASS="FILENAME"
>floppy</TT
> Group</TD
></TR
></TABLE
></DIV
></BODY
>
<!-- Mirrored from ftp.kh.edu.tw/Linux/Redhat/en_6.2/doc/ref-guide/s1-sysadmin-console-access.htm by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 06 Sep 2016 21:05:10 GMT -->
</HTML
>